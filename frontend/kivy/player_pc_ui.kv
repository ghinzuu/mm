#:include frontend/kivy/theme.kv

<PlayerUI>:
    name: "player"
    
    # theme color
    canvas.before:
        Color:
            rgba: 23/255, 32/255, 42/255, 1   # background
        Rectangle:
            pos: self.pos
            size: self.size

    FloatLayout:

        BoxLayout:
            orientation: "vertical"
            padding: 10
            spacing: 10

            # 1. Title Status Bar
            PrimaryLabel:
                id: title_status
                text: "Select a song"
                font_size: 20
                size_hint_x: 0.66   
                size_hint_y: None
                height: 40
                text_size: self.size  # needed for halign to work
                halign: "left"
                valign: "middle"

            # 2Ô∏è. Metadata Grid
            GridLayout:
                cols: 3
                spacing: 5
                size_hint_y: None
                height: 120

                # Column 1 - First set of PrimaryLabels & text inputs
                BoxLayout:
                    orientation: "vertical"
                    size_hint_x: 1/3
                    spacing: 5

                    BoxLayout:
                        Image:
                            id: title_icon
                            source: 'frontend/img/icons/songname.png'
                            center_x: self.parent.center_x
                            center_y: self.parent.center_y
                            size: 40, 40
                            size_hint_x: 0.3
                        ThemedTextInput:
                            id: title_input
                            hint_text: "Title"
                            size_hint_x: 0.7

                    BoxLayout:
                        Image:
                            id: artist_icon
                            source: 'frontend/img/icons/artist.png'
                            center_x: self.parent.center_x
                            center_y: self.parent.center_y
                            size: 40, 40
                            size_hint_x: 0.3
                        ThemedTextInput:
                            id: artist_input
                            hint_text: "Artist"
                            size_hint_x: 0.7

                    BoxLayout:
                        Image:
                            id: album_icon
                            source: 'frontend/img/icons/album.png'
                            center_x: self.parent.center_x
                            center_y: self.parent.center_y
                            size: 40, 40
                            size_hint_x: 0.3
                        ThemedTextInput:
                            id: album_input
                            hint_text: "Album"
                            size_hint_x: 0.7

                # Column 2 - Second set of PrimaryLabels & text inputs
                BoxLayout:
                    orientation: "vertical"
                    size_hint_x: 1/3
                    spacing: 5

                    BoxLayout:
                        Image:
                            id: genre_icon
                            source: 'frontend/img/icons/genre.png'
                            center_x: self.parent.center_x
                            center_y: self.parent.center_y
                            size: 40, 40
                            size_hint_x: 0.3
                        ThemedTextInput:
                            id: genre_input
                            hint_text: "Genre"
                            size_hint_x: 0.7

                    BoxLayout:
                        Image:
                            id: date_icon
                            source: 'frontend/img/icons/date.png'
                            center_x: self.parent.center_x
                            center_y: self.parent.center_y
                            size: 40, 40
                            size_hint_x: 0.3
                        ThemedTextInput:
                            id: date_input
                            hint_text: "Date"
                            size_hint_x: 0.7

                    TransparentButton:
                        id: edit_metadata
                        on_release: root.metadata_edit()
                        Image:
                            id: metadata_icon
                            source: 'frontend/img/icons/edit.png'
                            center_x: self.parent.center_x
                            center_y: self.parent.center_y
                            size_hint: None, None
                            size: 40, 40

                # Column 3 - Full-height image
                Image:
                    id: cover
                    source: "frontend/img/icons/cover.png"
                    size_hint_x: 1/3
                    size_hint_y: 1
                    size: 100, 120

            # 3. Slider Row
            BoxLayout:
                size_hint_y: None
                height: 50
                spacing: 10

                Slider:
                    id: progress_slider
                    min: 0
                    max: 100
                    scroll_timeout: 0
                    allow_scroll: False
                    on_touch_up: root.seek_in_song(self, args[1])

                PrimaryLabel:
                    id: current_time_label
                    text: "00:00"
                    size_hint_x: None
                    width: 50

                PrimaryLabel:
                    id: total_time_label
                    text: "/ 00:00"
                    size_hint_x: None
                    width: 50

            # 4. Action Bar
            BoxLayout:
                size_hint_y: None
                height: 50
                spacing: 3

                TransparentButton:
                    id: previous_button
                    #text: "<<"
                    on_release: root.previous()
                    Image:
                        id: previous_icon
                        source: 'frontend/img/icons/previous.png'
                        center_x: self.parent.center_x
                        center_y: self.parent.center_y
                        size_hint: None, None
                        size: 40, 40

                TransparentButton:
                    id: play_button
                    #text: "|>"
                    on_release: root.play()
                    Image:
                        id: play_icon
                        source: 'frontend/img/icons/play.png'
                        center_x: self.parent.center_x
                        center_y: self.parent.center_y
                        size_hint: None, None
                        size: 40, 40

                TransparentButton:
                    id: next_button
                    #text: ">>"
                    on_release: root.next()
                    Image:
                        id: next_icon
                        source: 'frontend/img/icons/next.png'
                        center_x: self.parent.center_x
                        center_y: self.parent.center_y
                        size_hint: None, None
                        size: 40, 40

                TransparentButton:
                    id: repeat_button
                    #text: "<=>"
                    on_release: root.toggle_repeat()
                    Image:
                        id: repeat_icon
                        source: 'frontend/img/icons/repeat.png'
                        center_x: self.parent.center_x
                        center_y: self.parent.center_y
                        size_hint: None, None
                        size: 40, 40

                TransparentButton:
                    id: sampler_button
                    #text: "[..]"
                    on_release: root.sampler()
                    Image:
                        id: sampler_icon
                        source: 'frontend/img/icons/sampler.png'
                        center_x: self.parent.center_x
                        center_y: self.parent.center_y
                        size_hint: None, None
                        size: 50, 50

                TransparentButton:
                    id: playlist_button
                    #text: "{=}"
                    on_release: root.playlist()
                    Image:
                        id: playlist_icon
                        source: 'frontend/img/icons/playlist.png'
                        center_x: self.parent.center_x
                        center_y: self.parent.center_y
                        size_hint: None, None
                        size: 40, 40
                
                TransparentButton:
                    id: music_dir_button
                    #text: ":"
                    on_release: root.music_directory_browser()
                    Image:
                        id: playlist_icon
                        source: 'frontend/img/icons/browse.png'
                        center_x: self.parent.center_x
                        center_y: self.parent.center_y
                        size_hint: None, None
                        size: 40, 40


            # 5. Music List + Next Song
            BoxLayout:
                orientation: "horizontal"

                RecycleView:
                    id: music_list
                    viewclass: "MusicItem"  # Links to the custom RecycleView entry
                    size_hint_x: 0.66
                    size_hint_y: 0.8

                    RecycleBoxLayout:
                        default_size: None, dp(40)
                        default_size_hint: 1, None
                        size_hint_y: None
                        height: self.minimum_height
                        orientation: "vertical"

                ClickableBox:
                    orientation: "vertical"
                    size_hint_x: 0.33
                    on_release: root.next()

                    NextSongPrimaryLabel:
                        text: "Next Song"
                        font_size: 18
                        size_hint_y: None
                        height: 40
                        
                    NextSongPrimaryLabel:
                        id: next_song_filepath
                        text: "Filepath: None"
                        font_size: 14
                        size_hint_y: None
                        height: 30

                    NextSongPrimaryLabel:
                        id: next_song_title
                        text: "Title: None"
                        font_size: 14
                        size_hint_y: None
                        height: 30

                    NextSongPrimaryLabel:
                        id: next_song_artist
                        text: "Artist: None"
                        font_size: 14
                        size_hint_y: None
                        height: 30

                    NextSongImage:
                        id: next_song_cover
                        source: "frontend/img/icons/cover.png"
                        size_hint: None, None
                        size: dp(100), dp(100)
                        pos_hint: {"center_x": 0.5}
        
        # Absolute placed widget
        TransparentButton:
            id: go_to_loader_button
            text: "Loader -->"
            size_hint: None, None
            size: dp(90), dp(40)
            pos_hint: {"right": 1, "center_y": 0.95}   # Stick to right, vertically up
            on_release: root.go_loaderUI()

<MusicItem@LightButton>:
    size_hint_y: None
    text_size: self.size  # needed for halign to work
    halign: "right"
    height: 40

<NextSongPrimaryLabel@ButtonBehavior+PrimaryLabel>:


<NextSongImage@ButtonBehavior+Image>:
