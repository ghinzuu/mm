#:include frontend/kivy/theme.kv

<PlayerUI>:
    name: "player"
    
    # theme color
    canvas.before:
        Color:
            rgba: 23/255, 32/255, 42/255, 1   # background
        Rectangle:
            pos: self.pos
            size: self.size

    FloatLayout:
        
        # Placeholder for cover
        Image:
            id: cover
            source: ""
            opacity: 0
            size_hint: None, None
            size: 0, 0

        BoxLayout:
            id: player_layout
            orientation: "vertical"
            size_hint: 1, 0.94
            padding: 10
            spacing: 5

            # 2️. Metadata Grid
            GridLayout:
                id: metadata_grid
                cols: 1
                spacing: 5
                size_hint_y: None
                height: self.minimum_height

                # Line 1 - Title 85% width
                BoxLayout:
                    size_hint_y: None
                    height: 30
                    spacing: 5
                    # Image:
                    #     id: title_icon
                    #     source: "frontend/img/icons/songname.png"
                    #     size_hint_x: 0.1
                    #     size: 30, 30
                    ThemedTextInput:
                        id: title_input
                        hint_text: "Title"
                        font_size: 13
                        size_hint_x: 0.95
                        readonly: True
                        disabled: True

                # Line 2 - Artist 
                BoxLayout:
                    size_hint_y: None
                    height: 30
                    spacing: 5
                    # Image:
                    #     id: artist_icon
                    #     source: "frontend/img/icons/artist.png"
                    #     size_hint_x: 0.1
                    #     size: 30, 30
                    ThemedTextInput:
                        id: artist_input
                        hint_text: "Artist"
                        font_size: 13
                        size_hint_x: 0.95
                        readonly: True
                        disabled: True
                    
                # Line 3 Album
                BoxLayout:
                    size_hint_y: None
                    height: 30
                    spacing: 5
                    # Image:
                    #     id: album_icon
                    #     source: "frontend/img/icons/album.png"
                    #     size_hint_x: 0.1
                    #     size: 30, 30
                    ThemedTextInput:
                        id: album_input
                        hint_text: "Album"
                        font_size: 13
                        size_hint_x: 0.95
                        readonly: True
                        disabled: True

                # Line 4 - Genre + Date + Edit
                BoxLayout:
                    size_hint_y: None
                    height: 30
                    spacing: 5
                    # Image:
                    #     id: genre_icon
                    #     source: "frontend/img/icons/genre.png"
                    #     size_hint_x: 0.1
                    #     size: 30, 30
                    ThemedTextInput:
                        id: genre_input
                        hint_text: "Genre"
                        font_size: 13
                        size_hint_x: 0.4
                        readonly: True
                        disabled: True
                    # Image:
                    #     id: date_icon
                    #     source: "frontend/img/icons/date.png"
                    #     size_hint_x: 0.1
                    #     size: 30, 30
                    ThemedTextInput:
                        id: date_input
                        hint_text: "Date"
                        font_size: 13
                        size_hint_x: 0.4
                        readonly: True
                        disabled: True  

                    TransparentButton:
                        id: edit_metadata
                        on_release: root.edit_metadata()
                        size_hint_x: 0.15
                        Image:
                            id: metadata_icon
                            source: 'frontend/img/icons/edit.png'
                            center_x: self.parent.center_x
                            center_y: self.parent.center_y
                            size_hint: None, None
                            size: 30, 30                  

            # 3. Slider Row
            BoxLayout:
                size_hint_y: None
                height: 40   # just the slider row
                spacing: 0

                Slider:
                    id: progress_slider
                    min: 0
                    max: 100
                    scroll_timeout: 0
                    allow_scroll: False
                    
                    # --- Track ---
                    background_width: 3
                    background_horizontal: ''   # empty string → no image
                    background_color: 0.15, 0.47, 0.95, 1 # blue   
                    # --- Active part (value track) ---
                    value_track: True
                    value_track_color: 0.35, 0.70, 0.64, 1 # green
                    value_track_width: 2
                    # --- Knob ---
                    cursor_size: (20, 20)
                    cursor_image: "frontend/img/icons/slider.png"
                    
                    on_touch_up: root.seek_in_song(self, args[1])

            # Times row
            BoxLayout:
                id: time_row
                size_hint_y: None
                height: 30  
                spacing: 0
                padding: [5, 0]  # tiny left/right padding

                PrimaryLabel:
                    id: current_time_label
                    text: "00:00"
                    font_size: "14sp"
                    halign: "left"
                    valign: "middle"
                    text_size: self.size

                BoxLayout:
                    #size_hint_y: None
                    size_hint_x: 1
                    height: 30
                    spacing: 3

                    TransparentButton:
                        id: previous_button
                        size_hint_x: 0.33
                        #text: "<<"
                        on_release: root.previous()
                        Image:
                            id: previous_icon
                            source: 'frontend/img/icons/previous.png'
                            center_x: self.parent.center_x
                            center_y: self.parent.center_y
                            size_hint: None, None
                            size: 30, 30

                    TransparentButton:
                        id: play_button
                        size_hint_x: 0.33
                        #text: "|>"
                        on_release: root.play()
                        Image:
                            id: play_icon
                            source: 'frontend/img/icons/play.png'
                            center_x: self.parent.center_x
                            center_y: self.parent.center_y
                            size_hint: None, None
                            size: 30, 30

                    TransparentButton:
                        id: next_button
                        size_hint_x: 0.33
                        #text: ">>"
                        on_release: root.next()
                        Image:
                            id: next_icon
                            source: 'frontend/img/icons/next.png'
                            center_x: self.parent.center_x
                            center_y: self.parent.center_y
                            size_hint: None, None
                            size: 30, 30

                PrimaryLabel:
                    id: total_time_label
                    text: "00:00"
                    font_size: "14sp"
                    halign: "right"
                    valign: "middle"
                    text_size: self.size

            # 4. Action Bar
            BoxLayout:
                id: action_bar
                size_hint_y: None
                height: 30
                spacing: 3

                TransparentButton:
                    id: blindtest_ui_button
                    #on_release: root.go_blindtestUI()
                    Image:
                        id: repeat_icon
                        source: 'frontend/img/icons/music.png'
                        center_x: self.parent.center_x
                        center_y: self.parent.center_y
                        size_hint: None, None
                        size: 30, 30

                TransparentButton:
                    id: repeat_button
                    #text: "<=>"
                    on_release: root.toggle_repeat()
                    Image:
                        id: repeat_icon
                        source: 'frontend/img/icons/repeat.png'
                        center_x: self.parent.center_x
                        center_y: self.parent.center_y
                        size_hint: None, None
                        size: 30, 30

                TransparentButton:
                    id: sampler_button
                    #text: "[..]"
                    on_release: root.sampler()
                    Image:
                        id: sampler_icon
                        source: 'frontend/img/icons/sampler.png'
                        center_x: self.parent.center_x
                        center_y: self.parent.center_y
                        size_hint: None, None
                        size: 30, 30

                TransparentButton:
                    id: lyrics_button
                    #on_release: root.display_lyrics()
                    Image:
                        id: playlist_icon
                        source: 'frontend/img/icons/lyrics.png'
                        center_x: self.parent.center_x
                        center_y: self.parent.center_y
                        size_hint: None, None
                        size: 30, 30

                TransparentButton:
                    id: music_dir_button
                    #text: ":"
                    on_release: root.music_directory_browser()
                    Image:
                        id: playlist_icon
                        source: 'frontend/img/icons/browse.png'
                        center_x: self.parent.center_x
                        center_y: self.parent.center_y
                        size_hint: None, None
                        size: 30, 30

                TransparentButton:
                    id: playlist_button
                    #text: "{=}"
                    on_release: root.list_playlists()
                    Image:
                        id: playlist_icon
                        source: 'frontend/img/icons/playlist.png'
                        center_x: self.parent.center_x
                        center_y: self.parent.center_y
                        size_hint: None, None
                        size: 30, 30
                
                TransparentButton:
                    id: loader_ui_button
                    #text: "-->"
                    on_release: root.go_loaderUI()
                    Image:
                        id: playlist_icon
                        source: 'frontend/img/icons/cloud.png'
                        center_x: self.parent.center_x
                        center_y: self.parent.center_y
                        size_hint: None, None
                        size: 30, 30

            # 5. Search bar + Music List 
            BoxLayout:
                id: music_list_container
                orientation: "vertical"
                spacing: 5
                
                # Search bar
                BoxLayout:
                    id: search_bar
                    orientation: "horizontal"
                    height: 30
                    #padding_bottom: 5
                    size_hint_y: None
                    
                    TransparentButton:
                        id: list_button
                        on_release: root.format_mp3_list()
                        size_hint_x: 0.15
                        Image:
                            id: list_icon
                            source: 'frontend/img/icons/extend_list.png'
                            center_x: self.parent.center_x
                            center_y: self.parent.center_y
                            size_hint: None, None
                            size: 30, 30 

                    ThemedTextInput:
                        id: search_input
                        hint_text: ""
                        font_size: 13
                        size_hint_x: 0.7
                        on_text: root.search()

                    TransparentButton:
                        id: search_button
                        #on_release: root.search()
                        size_hint_x: 0.15
                        Image:
                            id: search_icon
                            source: 'frontend/img/icons/search.png'
                            center_x: self.parent.center_x
                            center_y: self.parent.center_y
                            size_hint: None, None
                            size: 30, 30    

                RecycleView:
                    id: music_list
                    viewclass: "SongItem"  # Links to the custom RecycleView entry
                    size_hint_x: 1
                    size_hint_y: 0.8

                    RecycleBoxLayout:
                        default_size: None, dp(30)
                        default_size_hint: 1, None
                        size_hint_y: None
                        height: self.minimum_height
                        orientation: "vertical"
        

        # 1. Title Status Bar
        MarqueeLabel:
            id: title_status
            #text: "Select song 1234567891011121314151617181920212223242526272829"
            text: "Player"
            font_size: 20
            size_hint: 1, 0.98
            #height: 40
            #text_size: (self.width, None) # self.width
            #halign: "left"
            #pos_hint: {"top": 1} 
            # shorten: True
            # shorten_from: "right"


<SongItem>:
    size_hint_y: None
    #padding: 5
    #height: 10
    font_size: 13
    text_size: (self.width, None) # self.width
    halign: "left"
    valign: "middle"
    shorten: True
    shorten_from: "right"

    underline_width: 0
    underline_color: 0.35, 0.70, 0.64, 1
    canvas.after:
        Color:
            rgba: self.underline_color
        Rectangle:
            pos: self.x, self.y
            size: self.underline_width, 2
    

<NextSongPrimaryLabel@ButtonBehavior+PrimaryLabel>:


<NextSongImage@ButtonBehavior+Image>:


<PlaylistItem>:
    orientation: "horizontal"
    size_hint_y: None
    height: dp(40)
    spacing: 10
    padding: 5

    ToggleButton:
        group: "playlist_select"
        size_hint_x: 0.15
        on_state:
            if self.state == "down": root.on_select()

    Label:
        text: root.playlist_name
        size_hint_x: 0.7
        valign: "middle"
        halign: "left"
        text_size: self.size

    Button:
        text: "-"
        size_hint_x: 0.15
        on_release: root.on_delete()


<PlaylistPopup@Popup>:
    title: "Playlists"
    size_hint: 0.8, 0.8
    auto_dismiss: False

    BoxLayout:
        orientation: "vertical"
        spacing: 10
        padding: 10

        RecycleView:
            id: playlist_rv
            viewclass: "PlaylistItem"

            RecycleBoxLayout:
                orientation: "vertical"
                default_size: None, dp(40)
                default_size_hint: 1, None
                size_hint_y: None
                height: self.minimum_height

        BoxLayout:
            size_hint_y: None
            height: dp(40)
            spacing: 10

            Button:
                text: "Create playlist"
                on_release: root.create_playlist()

            Button:
                text: "Close"
                on_release: root.dismiss()

